<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éû„É≥„Éõ„Éº„É´„Éù„É≥„ÉóÁÇπÊ§ú„Ç¢„Éó„É™</title>
    
    <!-- „Éï„Ç°„Éì„Ç≥„É≥Ë®≠ÂÆö -->
    <link rel="icon" type="image/png" href="icon/r.png">
    <link rel="shortcut icon" href="icon/r.png">
    <link rel="apple-touch-icon" href="icon/r.png">
    
    <!-- Google Fonts - Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#546E7A">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-main">
                <img src="icon/main_mini.png" alt="„Éû„É≥„Éõ„Éº„É´„Éù„É≥„ÉóÁÇπÊ§ú„Ç∑„Çπ„ÉÜ„É†" class="header-logo">
                <h1>„Éû„É≥„Éõ„Éº„É´„Éù„É≥„ÉóÁÇπÊ§ú</h1>
            </div>
            <div class="header-actions">
                <button id="qr-scan-btn" class="btn btn-secondary">QR„Çπ„Ç≠„É£„É≥</button>
                <button id="data-export-btn" class="btn btn-secondary">„Éá„Éº„ÇøÂá∫Âäõ</button>
                <button id="master-edit-btn" class="btn btn-secondary">„Éû„Çπ„ÇøÁ∑®ÈõÜ</button>
            </div>
        </header>

        <!-- „Ç¢„É©„Éº„ÉàË°®Á§∫„Ç®„É™„Ç¢ -->
        <div id="alert-container" class="alert-container"></div>

        <main>
            <div class="tab-container">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="inspection">ÁÇπÊ§úÂÖ•Âäõ</button>
                    <button class="tab-btn" data-tab="history">ÁÇπÊ§úÂ±•Ê≠¥</button>
                    <button class="tab-btn" data-tab="graph">„Ç∞„É©„Éï</button>
                    <button class="tab-btn" data-tab="map">Âú∞Âõ≥</button>
                </div>

                <!-- ÁÇπÊ§úÂÖ•Âäõ„Çø„Éñ -->
                <div class="tab-content active" id="inspection-tab">
                    <form id="inspection-form">
                        <div class="form-section">
                            <h2>Âü∫Êú¨ÊÉÖÂ†±</h2>
                            <div class="form-group">
                                <label for="manhole-name">„Éû„É≥„Éõ„Éº„É´Âêç</label>
                                <select id="manhole-name" required>
                                    <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="inspection-date">ÁÇπÊ§úÊó•</label>
                                    <input type="date" id="inspection-date" required>
                                </div>
                                <div class="form-group">
                                    <label for="inspector">ÊãÖÂΩìËÄÖ</label>
                                    <div class="inspector-selection">
                                        <select id="inspector" multiple required>
                                            <option value="">ÊãÖÂΩìËÄÖ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                        </select>
                                        <button type="button" id="manage-inspectors-btn" class="btn-secondary">ÊãÖÂΩìËÄÖÁÆ°ÁêÜ</button>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="form-section">
                            <h2>ÈÅãËª¢Áä∂Ê≥Å</h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ÈÅãËª¢ÈÅ∏Êäû</label>
                                    <div class="radio-group">
                                        <label><input type="radio" name="operation-mode" value="Ëá™Âãï"> Ëá™Âãï</label>
                                        <label><input type="radio" name="operation-mode" value="ÊâãÂãï"> ÊâãÂãï</label>
                                        <label><input type="radio" name="operation-mode" value="ÂÅúÊ≠¢"> ÂÅúÊ≠¢</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>„Éù„É≥„ÉóÈÅ∏Êäû</label>
                                    <div class="radio-group">
                                        <label><input type="radio" name="pump-selection" value="‰∫§‰∫í"> ‰∫§‰∫í</label>
                                        <label><input type="radio" name="pump-selection" value="1Âè∑Ê©ü"> 1Âè∑Ê©ü</label>
                                        <label><input type="radio" name="pump-selection" value="2Âè∑Ê©ü"> 2Âè∑Ê©ü</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>ÈõªÊ∞óÁ≥ªÁµ±</h2>
                            <div class="form-group">
                                <label for="voltage">ÈõªÂúßË®à (210¬±20V)</label>
                                <div class="input-with-voice">
                                    <input type="number" id="voltage" placeholder="210">
                                    <button type="button" class="voice-btn" data-target="voltage">üé§</button>
                                </div>
                                <span class="warning" id="voltage-warning"></span>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="no1-current">No1ÈõªÊµÅÂÄ§</label>
                                    <div class="input-with-voice">
                                        <input type="number" id="no1-current" step="0.1" placeholder="0.0">
                                        <button type="button" class="voice-btn" data-target="no1-current">üé§</button>
                                    </div>
                                    <div class="current-info" id="no1-current-info"></div>
                                    <span class="warning" id="no1-current-warning"></span>
                                </div>
                                <div class="form-group">
                                    <label for="no2-current">No2ÈõªÊµÅÂÄ§</label>
                                    <div class="input-with-voice">
                                        <input type="number" id="no2-current" step="0.1" placeholder="0.0">
                                        <button type="button" class="voice-btn" data-target="no2-current">üé§</button>
                                    </div>
                                    <div class="current-info" id="no2-current-info"></div>
                                    <span class="warning" id="no2-current-warning"></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>Ê∞¥‰ΩçÊÉÖÂ†±</h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="operation-water-level">ÈÅãËª¢Ê∞¥‰Ωç</label>
                                    <div class="unit-input">
                                        <div class="input-with-voice">
                                            <input type="number" id="operation-water-level" step="0.01" placeholder="0.00">
                                            <button type="button" class="voice-btn" data-target="operation-water-level">üé§</button>
                                        </div>
                                        <select id="operation-water-level-unit">
                                            <option value="m">m</option>
                                            <option value="%">%</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="abnormal-water-level">Áï∞Â∏∏È´òÊ∞¥‰Ωç</label>
                                    <div class="unit-input">
                                        <div class="input-with-voice">
                                            <input type="number" id="abnormal-water-level" step="0.01" placeholder="0.00">
                                            <button type="button" class="voice-btn" data-target="abnormal-water-level">üé§</button>
                                        </div>
                                        <select id="abnormal-water-level-unit">
                                            <option value="m">m</option>
                                            <option value="%">%</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>ÁÇπÊ§úÈ†ÖÁõÆ</h2>
                            <div id="dynamic-inspection-items" class="dynamic-inspection-items">
                                <div class="no-manhole-selected">
                                    <p>„Éû„É≥„Éõ„Éº„É´„ÇíÈÅ∏Êäû„Åô„Çã„Å®„ÄÅ„Åù„ÅÆ„Éû„É≥„Éõ„Éº„É´Áî®„ÅÆÁÇπÊ§úÈ†ÖÁõÆ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</p>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>ÁâπË®ò‰∫ãÈ†Ö„ÉªÂÜôÁúü</h2>
                            <div class="form-group">
                                <label for="remarks">ÁâπË®ò‰∫ãÈ†ÖÔºàÂÇôËÄÉÊ¨ÑÔºâ</label>
                                <textarea id="remarks" rows="3" placeholder="ÁâπË®ò‰∫ãÈ†Ö„Åå„ÅÇ„Çå„Å∞Ë®òÂÖ•„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Áï∞Â∏∏ÁÆáÊâÄ„ÅÆÂÜôÁúü <span id="photo-count">0Êûö</span></label>
                                <div class="photo-section">
                                    <button type="button" id="take-photo-btn" class="btn btn-photo">ÂÜôÁúü„ÇíÊíÆÂΩ±</button>
                                    <input type="file" id="photo-input" accept="image/*" capture="camera" multiple style="display: none;">
                                    <div id="photo-preview-container" class="photo-preview-container"></div>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">ÁÇπÊ§ú„Éá„Éº„Çø„Çí‰øùÂ≠ò</button>
                            <button type="button" id="clear-form-btn" class="btn btn-secondary">„Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢</button>
                        </div>
                    </form>
                </div>

                <!-- ÁÇπÊ§úÂ±•Ê≠¥„Çø„Éñ -->
                <div class="tab-content" id="history-tab">
                    <div class="history-controls">
                        <div class="form-group">
                            <label for="history-manhole">„Éû„É≥„Éõ„Éº„É´Âêç</label>
                            <select id="history-manhole">
                                <option value="">ÂÖ®„Å¶</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="history-period">ÊúüÈñì</label>
                            <select id="history-period">
                                <option value="all">ÂÖ®ÊúüÈñì</option>
                                <option value="1month">1„É∂Êúà</option>
                                <option value="3months">3„É∂Êúà</option>
                                <option value="6months">6„É∂Êúà</option>
                                <option value="1year">1Âπ¥</option>
                            </select>
                        </div>
                    </div>
                    <div id="history-list" class="history-list"></div>
                </div>

                <!-- „Ç∞„É©„Éï„Çø„Éñ -->
                <div class="tab-content" id="graph-tab">
                    <div class="graph-controls">
                        <div class="form-group">
                            <label for="graph-manhole">„Éû„É≥„Éõ„Éº„É´Âêç</label>
                            <select id="graph-manhole">
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="graph-type">„Ç∞„É©„ÉïÁ®ÆÈ°û</label>
                            <select id="graph-type">
                                <option value="current">ÈõªÊµÅÂÄ§Êé®Áßª</option>
                                <option value="voltage">ÈõªÂúßÊé®Áßª</option>
                                <option value="water-level">Ê∞¥‰ΩçÊé®Áßª</option>
                            </select>
                        </div>
                    </div>
                    <div id="graph-container" class="graph-container">
                        <canvas id="chart" width="800" height="400"></canvas>
                    </div>
                    <div id="health-status" class="health-status"></div>
                </div>

                <!-- Âú∞Âõ≥„Çø„Éñ -->
                <div class="tab-content" id="map-tab">
                    <div class="map-controls">
                        <div class="form-group">
                            <label for="map-manhole">„Éû„É≥„Éõ„Éº„É´ÈÅ∏Êäû</label>
                            <select id="map-manhole">
                                <option value="">ÂÖ®„Å¶Ë°®Á§∫</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="manual-latitude">Á∑ØÂ∫¶</label>
                            <input type="number" id="manual-latitude" step="0.000001" placeholder="35.6762">
                        </div>
                        <div class="form-group">
                            <label for="manual-longitude">ÁµåÂ∫¶</label>
                            <input type="number" id="manual-longitude" step="0.000001" placeholder="139.6503">
                        </div>
                        <button id="get-location-btn" class="btn btn-primary">ÁèæÂú®Âú∞ÂèñÂæó</button>
                        <button id="add-location-btn" class="btn btn-secondary">ÊâãÂãï‰ΩçÁΩÆËøΩÂä†</button>
                        <button id="goto-location-btn" class="btn btn-secondary">‰ΩçÁΩÆ„Å∏ÁßªÂãï</button>
                    </div>
                    <div id="map-container" class="map-container">
                        <div id="map" style="height: 400px; width: 100%;"></div>
                    </div>
                    <div class="qr-controls">
                        <h3>QR„Ç≥„Éº„ÉâÁÆ°ÁêÜ</h3>
                        <div class="qr-actions">
                            <button id="generate-qr-btn" class="btn btn-primary">ÈÅ∏Êäû„Åó„Åü„Éû„É≥„Éõ„Éº„É´„ÅÆQRÁîüÊàê</button>
                            <button id="generate-all-qr-btn" class="btn btn-secondary">ÂÖ®„Éû„É≥„Éõ„Éº„É´QRÁîüÊàê</button>
                        </div>
                        <div id="qr-display" class="qr-display"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- „Éû„Çπ„ÇøÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
        <div id="master-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>„Éû„Çπ„ÇøÊÉÖÂ†±Á∑®ÈõÜ</h2>
                    <button class="close-btn" id="close-master-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="master-data-notice">
                        <p><strong>üíæ „Éá„Éº„Çø‰øùÂ≠ò„Å´„Å§„ÅÑ„Å¶Ôºö</strong> „Éû„Çπ„Çø„Éá„Éº„Çø„ÅØ„Éñ„É©„Ç¶„Ç∂ÂÜÖ„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åô„ÄÇ„Éá„Éº„Çø„ÇíÊ∞∏Á∂öÁöÑ„Å´‰øùÊåÅ„Åô„Çã„Å´„ÅØ„Äå„Éá„Éº„ÇøÂá∫Âäõ„Äç„Åã„Çâ„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÇíÂèñ„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                    </div>
                    <div class="master-tabs">
                        <button class="master-tab-btn active" data-master-tab="manholes">„Éû„É≥„Éõ„Éº„É´„Éû„Çπ„Çø</button>
                        <button class="master-tab-btn" data-master-tab="inspectors">ÊãÖÂΩìËÄÖ„Éû„Çπ„Çø</button>
                    </div>
                    
                    <!-- „Éû„É≥„Éõ„Éº„É´„Éû„Çπ„Çø„Çø„Éñ -->
                    <div class="master-tab-content active" id="manholes-master-tab">
                        <div class="master-controls">
                            <button id="add-manhole-btn" class="btn btn-primary">Êñ∞Ë¶è„Éû„É≥„Éõ„Éº„É´ËøΩÂä†</button>
                        </div>
                        <div id="master-list" class="master-list"></div>
                    </div>
                    
                    <!-- ÊãÖÂΩìËÄÖ„Éû„Çπ„Çø„Çø„Éñ -->
                    <div class="master-tab-content" id="inspectors-master-tab">
                        <div class="master-controls">
                            <div class="form-row">
                                <div class="form-group" style="flex: 1;">
                                    <input type="text" id="new-inspector-name" placeholder="ÊãÖÂΩìËÄÖÂêç„ÇíÂÖ•Âäõ" style="width: 100%;">
                                </div>
                                <div class="form-group">
                                    <button id="add-inspector-btn" class="btn btn-primary">ËøΩÂä†</button>
                                </div>
                            </div>
                        </div>
                        <div id="inspectors-master-list" class="master-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- „Éû„É≥„Éõ„Éº„É´Á∑®ÈõÜ„Éï„Ç©„Éº„É†„É¢„Éº„ÉÄ„É´ -->
        <div id="manhole-edit-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="manhole-form-title">„Éû„É≥„Éõ„Éº„É´Á∑®ÈõÜ</h2>
                    <button class="close-btn" id="close-manhole-edit-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="manhole-edit-form" class="manhole-form">
                        <div class="form-group">
                            <label for="edit-manhole-name">„Éû„É≥„Éõ„Éº„É´Âêç:</label>
                            <input type="text" id="edit-manhole-name" name="name" required>
                        </div>
                        
                        <div class="form-section">
                            <h3>„Éù„É≥„ÉóÂÆöÊ†ºÈõªÊµÅ (A)</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="rated-current-1">No1ÂÆöÊ†ºÈõªÊµÅ:</label>
                                    <input type="number" id="rated-current-1" name="ratedCurrent1" step="0.1" required>
                                </div>
                                <div class="form-group">
                                    <label for="rated-current-2">No2ÂÆöÊ†ºÈõªÊµÅ:</label>
                                    <input type="number" id="rated-current-2" name="ratedCurrent2" step="0.1" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>„Éù„É≥„ÉóÂá∫Âäõ (kW)</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="output-kw-1">No1Âá∫Âäõ:</label>
                                    <input type="number" id="output-kw-1" name="outputKw1" step="0.1" required>
                                </div>
                                <div class="form-group">
                                    <label for="output-kw-2">No2Âá∫Âäõ:</label>
                                    <input type="number" id="output-kw-2" name="outputKw2" step="0.1" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Ë≠¶ÂëäÁØÑÂõ≤Ë®≠ÂÆö</h3>
                            <div class="warning-range-container">
                                <div class="warning-range-section">
                                    <h4>No1ÈõªÊµÅË≠¶ÂëäÁØÑÂõ≤ (A)</h4>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="current-warning-min-1">ÊúÄÂ∞èÂÄ§:</label>
                                            <input type="number" id="current-warning-min-1" name="currentWarningMin1" step="0.1" placeholder="‰æã: 13.5">
                                        </div>
                                        <div class="form-group">
                                            <label for="current-warning-max-1">ÊúÄÂ§ßÂÄ§:</label>
                                            <input type="number" id="current-warning-max-1" name="currentWarningMax1" step="0.1" placeholder="‰æã: 16.5">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="warning-range-section">
                                    <h4>No2ÈõªÊµÅË≠¶ÂëäÁØÑÂõ≤ (A)</h4>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="current-warning-min-2">ÊúÄÂ∞èÂÄ§:</label>
                                            <input type="number" id="current-warning-min-2" name="currentWarningMin2" step="0.1" placeholder="‰æã: 13.5">
                                        </div>
                                        <div class="form-group">
                                            <label for="current-warning-max-2">ÊúÄÂ§ßÂÄ§:</label>
                                            <input type="number" id="current-warning-max-2" name="currentWarningMax2" step="0.1" placeholder="‰æã: 16.5">
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>‰ΩçÁΩÆÊÉÖÂ†±</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="latitude">Á∑ØÂ∫¶:</label>
                                    <input type="number" id="latitude" name="latitude" step="0.0000001" placeholder="‰æã: 37.1682890">
                                </div>
                                <div class="form-group">
                                    <label for="longitude">ÁµåÂ∫¶:</label>
                                    <input type="number" id="longitude" name="longitude" step="0.0000001" placeholder="‰æã: 138.9184600">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>ÁÇπÊ§úÈ†ÖÁõÆË®≠ÂÆö</h3>
                            <div class="inspection-items-header">
                                <p>„Åì„ÅÆ„Éû„É≥„Éõ„Éº„É´„Åß‰ΩøÁî®„Åô„ÇãÁÇπÊ§úÈ†ÖÁõÆ„ÇíË®≠ÂÆö„Åß„Åç„Åæ„Åô„ÄÇ</p>
                                <div class="inspection-items-controls">
                                    <button type="button" id="add-inspection-item-btn" class="btn btn-primary">ÁÇπÊ§úÈ†ÖÁõÆ„ÇíËøΩÂä†</button>
                                    <div class="copy-paste-controls">
                                        <select id="copy-source-manhole" class="form-control">
                                            <option value="">„Ç≥„Éî„ÉºÂÖÉ„Éû„É≥„Éõ„Éº„É´„ÇíÈÅ∏Êäû</option>
                                        </select>
                                        <button type="button" id="copy-inspection-items-btn" class="btn btn-secondary">ÁÇπÊ§úÈ†ÖÁõÆ„Çí„Ç≥„Éî„Éº</button>
                                        <button type="button" id="paste-inspection-items-btn" class="btn btn-secondary" disabled>ÁÇπÊ§úÈ†ÖÁõÆ„ÇíË≤º„Çä‰ªò„Åë</button>
                                    </div>
                                </div>
                            </div>
                            <div id="inspection-items-list" class="inspection-items-list">
                                <!-- ÁÇπÊ§úÈ†ÖÁõÆ„É™„Çπ„Éà„ÅØJavaScript„ÅßÂãïÁöÑÁîüÊàê -->
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancel-manhole-edit">„Ç≠„É£„É≥„Çª„É´</button>
                            <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ÁÇπÊ§úÈ†ÖÁõÆÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
        <div id="inspection-item-edit-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="inspection-item-form-title">ÁÇπÊ§úÈ†ÖÁõÆÁ∑®ÈõÜ</h2>
                    <button class="close-btn" id="close-inspection-item-edit-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="inspection-item-edit-form" class="inspection-item-form">
                        <div class="form-group">
                            <label for="item-name">È†ÖÁõÆÂêç:</label>
                            <input type="text" id="item-name" name="name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="item-type">È†ÖÁõÆ„Çø„Ç§„Éó:</label>
                            <select id="item-type" name="type" required>
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                <option value="checkbox">„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ</option>
                                <option value="selection">ÈÅ∏ÊäûËÇ¢</option>
                                <option value="numeric">Êï∞ÂÄ§ÂÖ•Âäõ</option>
                                <option value="text">ÊñáÂ≠óÂàóÂÖ•Âäõ</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="item-category">„Ç´„ÉÜ„Ç¥„É™:</label>
                            <input type="text" id="item-category" name="category" placeholder="‰æã: ÈÅãËª¢Áä∂Ê≥Å„ÄÅË®≠ÂÇôÁä∂Ê≥Å">
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="item-required" name="required">
                                ÂøÖÈ†àÈ†ÖÁõÆ
                            </label>
                        </div>

                        <!-- ÈÅ∏ÊäûËÇ¢Ë®≠ÂÆöÔºàselection typeÁî®Ôºâ -->
                        <div id="selection-settings" class="type-settings" style="display: none;">
                            <h4>ÈÅ∏ÊäûËÇ¢Ë®≠ÂÆö</h4>
                            <div class="form-group">
                                <label for="selection-options">ÈÅ∏ÊäûËÇ¢ÔºàÊîπË°åÂå∫Âàá„ÇäÔºâ:</label>
                                <textarea id="selection-options" rows="4" placeholder="‰æã:&#10;ËâØÂ•Ω&#10;Ë¶ÅÊ≥®ÊÑè&#10;Ë¶Å‰øÆÁêÜ&#10;Á∑äÊÄ•ÂØæÂøúÂøÖË¶Å"></textarea>
                            </div>
                        </div>

                        <!-- Êï∞ÂÄ§Ë®≠ÂÆöÔºànumeric typeÁî®Ôºâ -->
                        <div id="numeric-settings" class="type-settings" style="display: none;">
                            <h4>Êï∞ÂÄ§Ë®≠ÂÆö</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="decimal-places">Â∞èÊï∞ÁÇπ‰ª•‰∏ãÊ°ÅÊï∞:</label>
                                    <input type="number" id="decimal-places" min="0" max="5" value="2">
                                </div>
                                <div class="form-group">
                                    <label for="numeric-unit">Âçò‰Ωç:</label>
                                    <input type="text" id="numeric-unit" placeholder="‰æã: mm/s, ‚ÑÉ, %">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Ë≠¶ÂëäÁØÑÂõ≤Ë®≠ÂÆö</label>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="warning-min">ÊúÄÂ∞èÂÄ§:</label>
                                        <input type="number" id="warning-min" step="0.01">
                                    </div>
                                    <div class="form-group">
                                        <label for="warning-max">ÊúÄÂ§ßÂÄ§:</label>
                                        <input type="number" id="warning-max" step="0.01">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÊñáÂ≠óÂàóË®≠ÂÆöÔºàtext typeÁî®Ôºâ -->
                        <div id="text-settings" class="type-settings" style="display: none;">
                            <h4>ÊñáÂ≠óÂàóË®≠ÂÆö</h4>
                            <div class="form-group">
                                <label for="max-length">ÊúÄÂ§ßÊñáÂ≠óÊï∞:</label>
                                <input type="number" id="max-length" min="1" max="1000" value="500">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancel-inspection-item-edit">„Ç≠„É£„É≥„Çª„É´</button>
                            <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- „Éá„Éº„ÇøÂá∫Âäõ„É¢„Éº„ÉÄ„É´ -->
        <div id="export-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>„Éá„Éº„ÇøÂá∫Âäõ</h2>
                    <button class="close-btn" id="close-export-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="export-options">
                        <button id="export-csv-btn" class="btn btn-primary">CSVÂá∫Âäõ</button>
                        <button id="export-backup-btn" class="btn btn-secondary">„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÂá∫Âäõ</button>
                        <button id="import-backup-btn" class="btn btn-secondary">„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÂæ©ÂÖÉ</button>
                        <input type="file" id="backup-file-input" accept=".json" style="display: none;">
                    </div>
                    
                    <div class="export-section">
                        <h3>ÁÇπÊ§úÂ±•Ê≠¥ÁÆ°ÁêÜ</h3>
                        <div class="inspection-backup-options">
                            <button id="export-inspections-btn" class="btn btn-primary">ÁÇπÊ§úÂ±•Ê≠¥„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó</button>
                            <button id="import-inspections-btn" class="btn btn-secondary">ÁÇπÊ§úÂ±•Ê≠¥Âæ©ÂÖÉ</button>
                            <button id="merge-inspections-btn" class="btn btn-secondary">ÁÇπÊ§úÂ±•Ê≠¥„Éû„Éº„Ç∏</button>
                            <input type="file" id="inspections-file-input" accept=".json" style="display: none;">
                        </div>
                        <div class="merge-options" id="merge-options" style="display: none; margin-top: 10px;">
                            <label for="merge-mode">ÈáçË§á„Éá„Éº„Çø„ÅÆÂá¶ÁêÜ:</label>
                            <select id="merge-mode">
                                <option value="skip">„Çπ„Ç≠„ÉÉ„ÉóÔºàÈáçË§á„ÇíÁÑ°Ë¶ñÔºâ</option>
                                <option value="update">Êõ¥Êñ∞ÔºàÊó¢Â≠ò„Éá„Éº„Çø„Çí‰∏äÊõ∏„ÅçÔºâ</option>
                                <option value="duplicate">ÈáçË§áË®±ÂèØÔºàÂà•„Éá„Éº„Çø„Å®„Åó„Å¶ËøΩÂä†Ôºâ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="export-section">
                        <h3>„Éû„Çπ„Çø„Éï„Ç°„Ç§„É´ÁÆ°ÁêÜ</h3>
                        <div class="master-file-options">
                            <button id="export-manholes-btn" class="btn btn-secondary">„Éû„É≥„Éõ„Éº„É´„Éû„Çπ„ÇøÂá∫Âäõ</button>
                            <button id="import-manholes-btn" class="btn btn-secondary">„Éû„É≥„Éõ„Éº„É´„Éû„Çπ„ÇøË™≠Ëæº</button>
                            <input type="file" id="manholes-file-input" accept=".json" style="display: none;">
                        </div>
                        <div class="master-file-options">
                            <button id="export-inspectors-btn" class="btn btn-secondary">ÊãÖÂΩìËÄÖ„Éû„Çπ„ÇøÂá∫Âäõ</button>
                            <button id="import-inspectors-btn" class="btn btn-secondary">ÊãÖÂΩìËÄÖ„Éû„Çπ„ÇøË™≠Ëæº</button>
                            <input type="file" id="inspectors-file-input" accept=".json" style="display: none;">
                        </div>
                    </div>
                    
                    <div class="export-section">
                        <h3>ÊúàÂà•‰∏ÄÊã¨Âç∞Âà∑</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="print-year">Âπ¥</label>
                                <select id="print-year">
                                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="print-month">Êúà</label>
                                <select id="print-month">
                                    <option value="1">1Êúà</option>
                                    <option value="2">2Êúà</option>
                                    <option value="3">3Êúà</option>
                                    <option value="4">4Êúà</option>
                                    <option value="5">5Êúà</option>
                                    <option value="6">6Êúà</option>
                                    <option value="7">7Êúà</option>
                                    <option value="8">8Êúà</option>
                                    <option value="9">9Êúà</option>
                                    <option value="10">10Êúà</option>
                                    <option value="11">11Êúà</option>
                                    <option value="12">12Êúà</option>
                                </select>
                            </div>
                        </div>
                        <div class="print-options">
                            <button id="monthly-print-btn" class="btn btn-primary">Âç∞Âà∑ÂÆüË°å</button>
                            <button id="monthly-pdf-btn" class="btn btn-secondary">PDFÂá∫Âäõ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- QR„Çπ„Ç≠„É£„É≥„É¢„Éº„ÉÄ„É´ -->
        <div id="qr-scan-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>QR„Ç≥„Éº„Éâ„Çπ„Ç≠„É£„É≥</h2>
                    <button class="close-btn" id="close-qr-scan-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <video id="qr-video" style="width: 100%; max-width: 400px;"></video>
                    <div id="qr-result"></div>
                </div>
            </div>
        </div>

        <!-- ÊãÖÂΩìËÄÖÁÆ°ÁêÜ„É¢„Éº„ÉÄ„É´ -->
        <div id="inspector-management-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ÊãÖÂΩìËÄÖÁÆ°ÁêÜ</h2>
                    <button class="close-btn" id="close-inspector-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="inspector-form">
                        <h3>Êñ∞„Åó„ÅÑÊãÖÂΩìËÄÖ„ÇíËøΩÂä†</h3>
                        <div class="form-row">
                            <input type="text" id="new-inspector-name" placeholder="ÊãÖÂΩìËÄÖÂêç" required>
                            <button type="button" id="add-inspector-btn" class="btn btn-primary">ËøΩÂä†</button>
                        </div>
                    </div>
                    <div class="inspector-list">
                        <h3>ÁôªÈå≤Ê∏à„ÅøÊãÖÂΩìËÄÖ</h3>
                        <div id="inspector-list-container">
                            <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÂÜôÁúüË°®Á§∫„É¢„Éº„ÉÄ„É´ -->
        <div id="photo-view-modal" class="modal">
            <div class="modal-content photo-modal-content">
                <div class="modal-header">
                    <h2 id="photo-modal-title">ÁÇπÊ§úÂÜôÁúü</h2>
                    <button class="close-btn" id="close-photo-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="photo-gallery" class="photo-gallery">
                        <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                    <div id="photo-detail-view" class="photo-detail-view" style="display: none;">
                        <div class="photo-detail-header">
                            <button id="photo-detail-back" class="btn btn-secondary">Êàª„Çã</button>
                            <span id="photo-detail-info"></span>
                        </div>
                        <div class="photo-detail-content">
                            <img id="photo-detail-image" src="" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÊúàÂà•Âç∞Âà∑„É¨„Ç§„Ç¢„Ç¶„Éà -->
    <div id="monthly-print-layout" class="monthly-print-layout">
        <div class="print-header">
            <h1>„Éû„É≥„Éõ„Éº„É´„Éù„É≥„ÉóÁÇπÊ§úÂ±•Ê≠¥</h1>
            <p class="period" id="print-period"></p>
        </div>
        <div id="print-content" class="print-inspection-summary">
            <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/FileManager.js"></script>
    <script src="js/DatabaseManager.js"></script>
    <script src="js/DataManager.js"></script>
    <script src="js/managers/NotificationManager.js"></script>
    <script src="js/managers/NavigationManager.js"></script>
    <script src="js/managers/PhotoManager.js"></script>
    <script src="js/managers/ModalManager.js"></script>
    <script src="js/managers/FormManager.js"></script>
    <script src="js/managers/GraphManager.js"></script>
    <script src="js/UIManager.js"></script>
    <script src="js/MapManager.js"></script>
    <script src="js/VoiceManager.js"></script>
    <script src="js/QRManager.js"></script>
    <script src="js/ExportManager.js"></script>
    <script src="app-refactored.js"></script>
</body>
</html>